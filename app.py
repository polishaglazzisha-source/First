# -*- coding: utf-8 -*-
import os, re, time, uuid
from datetime import datetime
import streamlit as st
import gspread
from google.oauth2.service_account import Credentials

st.set_page_config(page_title='–ê–Ω–∫–µ—Ç–∞ (–®–∫–æ–ª–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –ù–ò–£ –í–®–≠)', page_icon='üìù', layout='centered')

# -------------------- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Google Sheets --------------------
SCOPES = ['https://www.googleapis.com/auth/spreadsheets']

SERVICE_INFO = None
SHEET_ID = None
try:
    SERVICE_INFO = dict(st.secrets['gcp_service_account'])
    secrets_gcp_loaded = True
except Exception:
    secrets_gcp_loaded = False
try:
    SHEET_ID = st.secrets.get('google_sheet_id', None)
    if not SHEET_ID and 'gcp_service_account' in st.secrets:
        SHEET_ID = st.secrets['gcp_service_account'].get('google_sheet_id', None)
    if not SHEET_ID and 'app' in st.secrets:
        SHEET_ID = st.secrets['app'].get('google_sheet_id', None)
except Exception:
    SHEET_ID = None
if not SHEET_ID:
    SHEET_ID = os.getenv('GOOGLE_SHEET_ID', None)

# –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å)
st.sidebar.write('secrets_gcp_loaded:', secrets_gcp_loaded)
st.sidebar.write('sheet_id_value_present:', bool(SHEET_ID))

if not secrets_gcp_loaded or not SHEET_ID:
    st.error('–ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Google Sheets.')
    st.stop()

creds = Credentials.from_service_account_info(SERVICE_INFO, scopes=SCOPES)
gc = gspread.authorize(creds)
sh = gc.open_by_key(SHEET_ID)
ws = sh.sheet1

# -------------------- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏/—Ç–µ–∫—Å—Ç—ã --------------------
q1_options = [
    '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–µ–º–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏',
    '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª',
    '–ï–¥–∏–Ω—Å—Ç–≤–æ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –≤—Å–µ—Ö –ª—é–¥–µ–π',
    '–ó–¥–æ—Ä–æ–≤—å–µ',
    '–ö–∞—Ä—å–µ—Ä–∞',
    '–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç',
    '–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç–∞—Ç–æ–∫',
    '–û–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ',
    '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω—É–∂–¥—ã –≤ —á–µ–º-—Ç–æ, —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏',
    '–ü–æ–¥–æ–±—Ä–∞—Ç—å —É–≤–ª–µ—á–µ–Ω–∏–µ, —Å–æ–≥–ª–∞—Å—É—é—â–µ–µ—Å—è —Å –º–æ–µ–π –Ω–∞—Ç—É—Ä–æ–π',
    '–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ',
    '–°–≤–æ–±–æ–¥–∞',
    '–°–µ–º–µ–π–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ',
    '–°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è –≤ —Å–≤–æ–µ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏',
    '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤ –æ–±—â–µ—Å—Ç–≤–µ',
    '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–ª –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö',
    '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å',
    '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –±–æ–ª–µ–µ –≥—É–º–∞–Ω–Ω–æ–≥–æ –∏ —Ç–µ—Ä–ø–∏–º–æ–≥–æ –æ–±—â–µ—Å—Ç–≤–∞',
    '–£–≤–∞–∂–µ–Ω–∏–µ —Å—Ä–µ–¥–∏ –∑–Ω–∞–∫–æ–º—ã—Ö',
    '–•–æ—Ä–æ—à–∞—è, –ø—Ä–µ—Å—Ç–∏–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞',
    '–®–∏—Ä–æ—Ç–∞ –≤–∑–≥–ª—è–¥–æ–≤'
]

b2_text = {
    1: '–ß–∞—Å—Ç–æ –ª–∏ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ —Ç—è–≥—É –∫ –Ω–æ–≤—ã–º –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º, –∫ —Ç–æ–º—É, —á—Ç–æ–±—ã –æ—Ç–≤–ª–µ—á—å—Å—è, –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–µ –æ—â—É—â–µ–Ω–∏—è?',
    2: '–°—á–∏—Ç–∞–µ—Ç–µ –ª–∏ –≤—ã —Å–µ–±—è –±–µ–∑–∑–∞–±–æ—Ç–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º?',
    3: '–û–±–¥—É–º—ã–≤–∞–µ—Ç–µ –ª–∏ –≤—ã —Å–≤–æ–∏ –¥–µ–ª–∞ –Ω–µ —Å–ø–µ—à–∞ –∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –ª–∏ –ø–æ–¥–æ–∂–¥–∞—Ç—å, –ø—Ä–µ–∂–¥–µ —á–µ–º –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å?',
    4: '–í—Å–µ–≥–¥–∞ –ª–∏ –≤—ã —Å–¥–µ—Ä–∂–∏–≤–∞–µ—Ç–µ —Å–≤–æ–∏ –æ–±–µ—â–∞–Ω–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ –≤–∞–º –Ω–µ–≤—ã–≥–æ–¥–Ω–æ?',
    5: '–ë—ã—Å—Ç—Ä–æ –ª–∏ –≤—ã –æ–±—ã—á–Ω–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ, –Ω–µ —Ç—Ä–∞—Ç–∏—Ç–µ –ª–∏ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ–±–¥—É–º—ã–≤–∞–Ω–∏–µ?',
    6: '–í–µ—Ä–Ω–æ –ª–∏, —á—Ç–æ –Ω–∞ —Å–ø–æ—Ä –≤—ã —Å–ø–æ—Å–æ–±–Ω—ã —Ä–µ—à–∏—Ç—å—Å—è –Ω–∞ –≤—Å—ë?',
    7: '–ë—ã–≤–∞–µ—Ç –ª–∏ –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å, —á—Ç–æ, —Ä–∞–∑–æ–∑–ª–∏–≤—à–∏—Å—å, –≤—ã –≤—ã—Ö–æ–¥–∏—Ç–µ –∏–∑ —Å–µ–±—è?',
    8: '–ß–∞—Å—Ç–æ –ª–∏ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –≤—ã –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –Ω–µ–æ–±–¥—É–º–∞–Ω–Ω–æ, –ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º –º–æ–º–µ–Ω—Ç–∞?',
    9: '–õ—é–±–∏—Ç–µ –ª–∏ –≤—ã —á–∞—Å—Ç–æ –±—ã–≤–∞—Ç—å –≤ –∫–æ–º–ø–∞–Ω–∏–∏ –∑–Ω–∞–∫–æ–º—ã—Ö –∏ –¥—Ä—É–∑–µ–π?',
    10: '–ë—ã–≤–∞—é—Ç –ª–∏ –∏–Ω–æ–≥–¥–∞ —É –≤–∞—Å —Ç–∞–∫–∏–µ –º—ã—Å–ª–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –≤–∞–º –Ω–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã –¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏?',
    11: '–°—Ç–∞—Ä–∞–µ—Ç–µ—Å—å –ª–∏ –≤—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫—Ä—É–≥ —Å–≤–æ–∏—Ö –∑–Ω–∞–∫–æ–º—ã—Ö –Ω–µ–±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º —Å–∞–º—ã—Ö –±–ª–∏–∑–∫–∏—Ö –¥—Ä—É–∑–µ–π?',
    12: '–ö–æ–≥–¥–∞ –Ω–∞ –≤–∞—Å –∫—Ä–∏—á–∞—Ç, –æ—Ç–≤–µ—á–∞–µ—Ç–µ –ª–∏ –≤—ã —Ç–µ–º –∂–µ?',
    13: '–°—á–∏—Ç–∞–µ—Ç–µ –ª–∏ –≤—ã –≤—Å–µ —Å–≤–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏ —Ö–æ—Ä–æ—à–∏–º–∏?',
    14: '–°–ø–æ—Å–æ–±–Ω—ã –ª–∏ –≤—ã –∏–Ω–æ–≥–¥–∞ –¥–∞—Ç—å –≤–æ–ª—é —Å–≤–æ–∏–º —á—É–≤—Å—Ç–≤–∞–º –∏ –±–µ–∑–∑–∞–±–æ—Ç–Ω–æ —Ä–∞–∑–≤–ª–µ—á—å—Å—è —Å –≤–µ—Å–µ–ª–æ–π –∫–æ–º–ø–∞–Ω–∏–µ–π?',
    15: '–°–ª—ã–≤–µ—Ç–µ –ª–∏ –≤—ã –∑–∞ —á–µ–ª–æ–≤–µ–∫–æ–º –∞–∫—Ç–∏–≤–Ω—ã–º –∏ –≤–µ—Å—ë–ª—ã–º?',
    16: '–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã —Å–µ–±—è –Ω–µ—Å–ø–æ–∫–æ–π–Ω–æ, –Ω–∞—Ö–æ–¥—è—Å—å –≤ –±–æ–ª—å—à–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?',
    17: '–ë—ã–≤–∞–µ—Ç –ª–∏, —á—Ç–æ –≤—ã –ø–µ—Ä–µ–¥–∞—ë—Ç–µ —Å–ª—É—Ö–∏?',
    18: '–ù—Ä–∞–≤–∏—Ç—Å—è –ª–∏ –≤–∞–º —Ä–∞–±–æ—Ç–∞, —Ç—Ä–µ–±—É—é—â–∞—è —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∏—è?',
    19: '–í—Å–µ–≥–¥–∞ –ª–∏ –≤—ã –≥–æ–≤–æ—Ä–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–¥—É?',
    20: '–ë—ã–≤–∞–µ—Ç –ª–∏ –≤–∞–º –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –∫–æ–º–ø–∞–Ω–∏–∏, –≥–¥–µ –≤—Å–µ –ø–æ–¥—à—É—á–∏–≤–∞—é—Ç –¥—Ä—É–≥ –Ω–∞–¥ –¥—Ä—É–≥–æ–º?',
    21: '–í–µ—Ä–Ω–æ –ª–∏, —á—Ç–æ –≤—ã –Ω–µ—Ç–æ—Ä–æ–ø–ª–∏–≤—ã –≤ –¥–≤–∏–∂–µ–Ω–∏—è—Ö –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–¥–ª–∏—Ç–µ–ª—å–Ω—ã?',
    22: '–û–ø–∞–∑–¥—ã–≤–∞–ª–∏ –ª–∏ –≤—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –Ω–∞ —Ä–∞–±–æ—Ç—É –∏–ª–∏ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É —Å –∫–µ–º-–ª–∏–±–æ?'
}

q3_options = [
    '–í –∂–∏–∑–Ω–∏ –∏–≥—Ä–∞—é —Ç–∞–∫ –º–Ω–æ–≥–æ —Ä–æ–ª–µ–π –Ω–∞ —Ä–∞–±–æ—Ç–µ, –¥–æ–º–∞ –∏ –≤ –æ–±—â–µ—Å—Ç–≤–µ, —á—Ç–æ –±–æ—é—Å—å –ø–æ—Ç–µ—Ä–∏ —Å–µ–±—è',
    '–í –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —É–±–µ–∂–¥–∞—é —Å–µ–±—è –∏ –¥—Ä—É–≥–∏—Ö, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Å—Ç–æ–∏—Ç ¬´–≤—ã–µ–¥–µ–Ω–Ω–æ–≥–æ —è–π—Ü–∞¬ª',
    '–í –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ –±–æ–ª—å—à–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, —É—Å—Ç–∞–ª–æ—Å—Ç—å, –Ω–µ—Ç –æ—â—É—â–µ–Ω–∏—è –æ—Ç–¥—ã—Ö–∞',
    '–í –Ω–µ—É–¥–∞—á–µ –≥–æ–≤–æ—Ä—é —Å–µ–±–µ: ¬´–ù—É–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑¬ª',
    '–í —Å—Å–æ—Ä–µ –ª–µ–≥–∫–æ –≤—ã—Ä–∞–∂–∞—é —á—É–≤—Å—Ç–≤–∞, –æ–±–æ–∑–Ω–∞—á–∞—é –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏, –≤—ã—Å–ª—É—à–∏–≤–∞—é –¥—Ä—É–≥–∏—Ö',
    '–í–æ–∑–Ω–∏–∫–∞—é—â–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å',
    '–î—É–º–∞—é, —á—Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–µ–æ–¥–æ–ª–µ—é –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –∏ –¥–æ–±—å—é—Å—å —Å–≤–æ–µ–≥–æ',
    '–ï—Å–ª–∏ –æ–±–∏–¥–µ–ª–∏ ‚Äî —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é –∏ –±–µ—Å–ø–æ–∫–æ—é—Å—å',
    '–ï—Å–ª–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è ‚Äî —É–ø–æ—Ä—Å—Ç–≤—É—é –∏ –ø—Ä–∏–ª–∞–≥–∞—é –≤—Å–µ —É—Å–∏–ª–∏—è',
    '–ï—Å–ª–∏ –≤—Å–ø—ã–ª–∏–ª ‚Äî –≤–µ–¥—É —Å–µ–±—è –æ—Ç—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π',
    '–û—Ç–∫–ª–∞–¥—ã–≤–∞—é —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –Ω–∞–¥–µ–∂–¥–µ, —á—Ç–æ —Ä–µ—à–∏—Ç—Å—è —Å–∞–º–∞',
    '–ö–æ–Ω—Ñ–ª–∏–∫—Ç —É–≥–Ω–µ—Ç–∞–µ—Ç ‚Äî —É—Ö–æ–∂—É –≤ –¥—Ä—É–≥–∏–µ –¥–µ–ª–∞/–∂–¥—É, —á—Ç–æ –≤—Ä–µ–º—è —Ä–∞—Å—Å—Ç–∞–≤–∏—Ç —Ç–æ—á–∫–∏',
    '–ù–µ—É–¥–∞—á–∏ –ø–æ–±—É–∂–¥–∞—é—Ç –∫ –µ—â—ë –±–æ–ª—å—à–∏–º —É—Å–∏–ª–∏—è–º',
    '–ù–µ—É–¥–∞—á–∏ –ø–æ–±—É–∂–¥–∞—é—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è, —á—Ç–æ–±—ã –∑–∞–±—ã—Ç—å',
    '–ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–±–µ–≥–∞—é —Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ —Å—Å–æ—Ä–∞—Ö',
    '–ü–æ—Ä–∞–∂–µ–Ω–∏—è –ø–æ–±—É–∂–¥–∞—é—Ç –≤–æ –º–Ω–µ –Ω–æ–≤—ã–µ —Å–∏–ª—ã',
    '–ü–æ—Å–ª–µ —Å—Å–æ—Ä—ã —á—É–≤—Å—Ç–≤—É—é –≤–∏–Ω—É –∏ —Å—Ç–∞—Ä–∞—é—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è',
    '–°–∏—Ç—É–∞—Ü–∏–∏ —Å—Ç—Ä–µ—Å—Å–∞ –ø—Ä–∏–Ω–∏–º–∞—é –±–ª–∏–∑–∫–æ –∫ —Å–µ—Ä–¥—Ü—É –∏ —Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é',
    '–°—Ç–æ–ª–∫–Ω—É–≤—à–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π, –∏—â—É –ø–æ–¥–¥–µ—Ä–∂–∫—É —É –æ–∫—Ä—É–∂–∞—é—â–∏—Ö',
    '–°—Ç—Ä–µ—Å—Å –≤—ã–º–∞—Ç—ã–≤–∞–µ—Ç ‚Äî –±–µ—Ä–µ–≥—É —ç–Ω–µ—Ä–≥–∏—é, –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –≤—Å—ë —Ä–∞—Å—Å–æ—Å—ë—Ç—Å—è',
    '–¢—Ä–µ–≤–æ–≥–∞ –ø—Ä–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏, —Ç—Ä—É–¥–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏'
]

q4_options = [
    '–ì–æ–≤–æ—Ä–∏–ª —Å –∫–µ–º-–ª–∏–±–æ, –∫—Ç–æ –º–æ–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø–æ–º–æ—á—å',
    '–î—É–º–∞–ª –æ —Ç–æ–º, –∫–∞–∫ –±—ã –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–º —è –≤–æ—Å—Ö–∏—â–∞—é—Å—å',
    '–ó–Ω–∞–ª, —á—Ç–æ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å, –∏ —É–¥–≤–∞–∏–≤–∞–ª —É—Å–∏–ª–∏—è',
    '–ú–æ–ª–∏–ª—Å—è',
    '–ù–∞–±–∏—Ä–∞–ª—Å—è –æ–ø—ã—Ç–∞ –≤ –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏',
    '–ù–∞—Ö–æ–¥–∏–ª –Ω–æ–≤—É—é –≤–µ—Ä—É –≤–æ —á—Ç–æ-—Ç–æ',
    '–û—Ç–∫–∞–∑—ã–≤–∞–ª—Å—è –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —ç—Ç–æ —Å–ª–∏—à–∫–æ–º —Å–µ—Ä—å—ë–∑–Ω–æ',
    '–ü–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø—Ä–æ—à–ª—ã–º –æ–ø—ã—Ç–æ–º ‚Äì –º–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å —É–∂–µ –ø–æ–ø–∞–¥–∞—Ç—å –≤ —Ç–∞–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏',
    '–ü—ã—Ç–∞–ª—Å—è —É–ª—É—á—à–∏—Ç—å —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –µ–¥–æ–π, –≤—ã–ø–∏–≤–∫–æ–π, –∫—É—Ä–µ–Ω–∏–µ–º –∏–ª–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏',
    '–°–ø—Ä–∞—à–∏–≤–∞–ª —Å–æ–≤–µ—Ç–∞ —É —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ –∏–ª–∏ –¥—Ä—É–≥–∞, –∫–æ—Ç–æ—Ä—ã—Ö —É–≤–∞–∂–∞–ª',
    '–°—Ç–∞—Ä–∞–ª—Å—è –¥–∞—Ç—å –∫–∞–∫–æ–π-—Ç–æ –≤—ã—Ö–æ–¥ —Å–≤–æ–∏–º —á—É–≤—Å—Ç–≤–∞–º',
    '–°—Ç–∞—Ä–∞–ª—Å—è, —á—Ç–æ–±—ã –º–æ–∏ —ç–º–æ—Ü–∏–∏ –Ω–µ —Å–ª–∏—à–∫–æ–º –º–µ—à–∞–ª–∏ –º–Ω–µ –≤ –¥—Ä—É–≥–∏—Ö –¥–µ–ª–∞—Ö',
    '–°—Ç–æ—è–ª –Ω–∞ —Å–≤–æ—ë–º –∏ –±–æ—Ä–æ–ª—Å—è –∑–∞ —Ç–æ, —á–µ–≥–æ —Ö–æ—Ç–µ–ª',
    '–ß—Ç–æ-—Ç–æ –º–µ–Ω—è–ª –≤ —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏ —Ç–∞–∫, —á—Ç–æ –≤—Å—ë —É–ª–∞–∂–∏–≤–∞–ª–æ—Å—å',
    '–ß—Ç–æ-—Ç–æ –º–µ–Ω—è–ª –≤ —Å–µ–±–µ',
    '–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'
]

q5_items = [
    '–£—á–∞—Å—Ç–≤—É—é –≤ –º–æ–ª–æ–¥–µ–∂–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–æ—Ä—É–º–∞—Ö',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –¥–æ–±—Ä–æ–≤–æ–ª—å—á–µ—Å–∫–æ–π (–≤–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–æ–π) –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
    '–Ø–≤–ª—è—é—Å—å —á–ª–µ–Ω–æ–º —Å–æ—Ü–∏–∞–ª—å–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ù–ö–û, –º–æ–ª–æ–¥–µ–∂–Ω—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–π',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –≤—ã–±–æ—Ä–∞—Ö',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–ª–æ–¥–µ–∂–Ω–æ–≥–æ –ø–∞—Ä–ª–∞–º–µ–Ω—Ç–∞ / –ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–∞—Ä—Ç–∏–∏',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –≤–æ–∂–∞—Ç—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Ç—Ä—è–¥—ã)',
    '–†–µ–∞–ª–∏–∑—É—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –ø–æ–∏—Å–∫–æ–≤–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–≤–æ–µ–Ω–Ω–æ-–ø–∞—Ç—Ä–∏–æ—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å)',
    '–£—á–∞—Å—Ç–≤—É—é –≤ –Ω–∞—É—á–Ω—ã—Ö –∏/–∏–ª–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∞—Ö',
    '–ó–∞–Ω–∏–º–∞—é—Å—å —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–º/—É—á–µ–Ω–∏—á–µ—Å–∫–∏–º —Å–∞–º–æ—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º',
    '–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'
]
FREQ3 = ['–†–µ–≥—É–ª—è—Ä–Ω–æ', '–ò–Ω–æ–≥–¥–∞', '–ù–∏–∫–æ–≥–¥–∞']
MAP_Q5 = {'–†–µ–≥—É–ª—è—Ä–Ω–æ': 2, '–ò–Ω–æ–≥–¥–∞': 1, '–ù–∏–∫–æ–≥–¥–∞': 0}

q6_items = [
    '–í—ã—Å–∫–∞–∑—ã–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ-–∑–Ω–∞—á–∏–º—ã–º –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º –≤ –±–ª–æ–≥–∞—Ö, —Ñ–æ—Ä—É–º–∞—Ö, —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö, –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –Ω–∞ –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö',
    '–ü–æ—Å–µ—â–µ–Ω–∏–µ —Å–∞–π—Ç–æ–≤ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä—Ç–∏–π, –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö (–Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö) –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π',
    '–ü–æ—Å–µ—â–µ–Ω–∏–µ —Å–∞–π—Ç–æ–≤/—Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ—è—Ç–µ–ª–µ–π, –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–∫—Ç–∏–≤–∏—Å—Ç–æ–≤',
    '–£—á–∞—Å—Ç–∏–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–æ–ø—Ä–æ—Å–∞—Ö –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è—Ö',
    '–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–µ—Ç–∏—Ü–∏–π, –æ–±—Ä–∞—â–µ–Ω–∏–π',
    '–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Å—Ç–Ω—ã—Ö (–ª–æ–∫–∞–ª—å–Ω—ã—Ö) –∑–Ω–∞—á–∏–º—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –Ω–∞ –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö, –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö',
    '–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—â–µ–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–∏–º—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –Ω–∞ –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö, –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö',
    '–£—á–∞—Å—Ç–∏–µ –≤ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–µ / –ø—É–±–ª–∏—á–Ω–æ–π –æ—Ü–µ–Ω–∫–µ –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç–æ–≤',
    '–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ / –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä—Ç–∏–π',
    '–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ / –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö (–Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö) –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π',
    '–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ / –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ—è—Ç–µ–ª–µ–π',
    '–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ / –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ—è—Ç–µ–ª–µ–π',
    '–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Å—Ç–Ω—ã—Ö (–ª–æ–∫–∞–ª—å–Ω—ã—Ö) –∑–Ω–∞—á–∏–º—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –Ω–∞ –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö, –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö',
    '–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—â–µ–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–∏–º—ã—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –Ω–∞ –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö, –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö',
    '–ñ–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (–∑–∞–ø–∏—Å—å –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –∞–ª—å–±–æ–º–æ–≤, —Å—ä—ë–º–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏ —Ç.–¥.)',
    '–ñ–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤',
    '–ñ–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ –Ω–∞ –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –∏–Ω—ã–µ –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏',
    '–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'  # –±–µ–∑ –ø–æ–ª–∑—É–Ω–∫–∞ ‚Äî —á–µ–∫–±–æ–∫—Å + –æ–ø–∏—Å–∞–Ω–∏–µ
]

# -------------------- –ü–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∑–∞–ø–∏—Å–∏ --------------------
HEADERS = [
    'response_id', 'ts', 'duration_sec', 'email',
    'q1_values', 'q1_adaptation_cnt', 'q1_socialization_cnt', 'q1_individualization_cnt',
    *[f'b2_{i}' for i in range(1, 23)],
    'b2_extro_score', 'b2_extro_class', 'b2_otro_score', 'b2_otro_class',
    'q3_values', 'q3_reliable_cnt', 'q3_anxious_cnt', 'q3_avoidant_cnt',
    'q4_values', 'q4_free',
    *[f'q5_{name}' for name in q5_items],
    'q5_free_text',
    *[f'q5_{name}_code' for name in q5_items],
    *[f'q6_{name}' for name in q6_items],
    'q6_free_text',
    *[f'q6_{name}_any' for name in q6_items],
    'q7_any_dreams', 'q8_2025', 'q9_5y', 'q10_10_20y',
    'sex', 'age', 'edu', 'sector', 'family', 'kids', 'living', 'locality', 'consent'
]

# -------------------- –£—Ç–∏–ª–∏—Ç—ã --------------------
def validate_multiselect(values, min_sel=None, max_sel=None):
    n = len(values)
    if min_sel is not None and n < min_sel:
        return False, f'–Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º {min_sel}'
    if max_sel is not None and n > max_sel:
        return False, f'–º–æ–∂–Ω–æ –Ω–µ –±–æ–ª–µ–µ {max_sel}'
    return True, ''

def _valid_email(s):
    return re.match(r'^[^@\s]+@[^@\s]+\.[^@\s]+$', s) is not None

def _has_cyrillic(s):
    return bool(re.search(r'[–ê-–Ø–∞-—è–Å—ë]', s or ''))

def score_block2(ans):
    yes, no = '–î–∞', '–ù–µ—Ç'
    extro_yes = {1,2,5,6,8,9,12,14,15}
    extro_no  = {3,11,16,18,20,21}
    otro_yes  = {7,10,17,22}
    otro_no   = {4,13,19}
    extro_score = sum(1 for i in extro_yes if ans.get(f'b2_{i}') == yes) + \
                  sum(1 for i in extro_no  if ans.get(f'b2_{i}') == no)
    otro_score  = sum(1 for i in otro_yes if ans.get(f'b2_{i}') == yes) + \
                  sum(1 for i in otro_no  if ans.get(f'b2_{i}') == no)
    if 0 <= extro_score <= 6:
        extro_class = '–∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç–Ω–æ—Å—Ç—å'
    elif 7 <= extro_score <= 8:
        extro_class = '–∞–º–±–∏–≤–µ—Ä—Ç–Ω–æ—Å—Ç—å'
    elif 9 <= extro_score <= 15:
        extro_class = '—ç–∫—Å—Ç—Ä–∞–≤–µ—Ä—Ç–Ω–æ—Å—Ç—å'
    else:
        extro_class = '–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'
    if 5 <= otro_score <= 7:
        otro_class = '–æ—Ç—Ä–æ–≤–µ—Ä—Ç–Ω–æ—Å—Ç—å'
    else:
        otro_class = '–Ω–µ –≤—ã—Ä–∞–∂–µ–Ω–∞'
    return extro_score, extro_class, otro_score, otro_class

def orientations_counts_q1(selected_labels):
    idx_by_label = {lab: i+1 for i, lab in enumerate(q1_options)}
    selected_idx = {idx_by_label[l] for l in selected_labels if l in idx_by_label}
    adapt = {4,7,9,10,15,16,17}
    social = {3,8,13,14,19,20,21}
    indiv = {1,2,5,6,11,12,18}
    return len(selected_idx & adapt), len(selected_idx & social), len(selected_idx & indiv)

def stress_types_counts_q3(selected_labels):
    idx_by_label = {lab: i+1 for i, lab in enumerate(q3_options)}
    selected_idx = {idx_by_label[l] for l in selected_labels if l in idx_by_label}
    reliable = {4,5,6,7,9,13,16}
    anxious  = {1,3,8,17,18,19,21}
    avoidant = {2,10,11,12,14,15,20}
    return len(selected_idx & reliable), len(selected_idx & anxious), len(selected_idx & avoidant)

# -------- –¢–ò–•–ê–Ø –∑–∞–ø–∏—Å—å –±–µ–∑ —à–∞–ø–∫–∏ ----------
def append_to_sheet(headers, row_dict):
    # –µ—Å–ª–∏ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ —É–∂–µ –µ—Å—Ç—å –≤–∞—à–∞ —à–∞–ø–∫–∞ ‚Äî –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º—Å—è –ø–æ –Ω–µ–π
    try:
        rows = ws.get_all_values()
    except Exception:
        rows = []
    target_headers = rows[0] if rows else headers
    ws.append_row([row_dict.get(h, '') for h in target_headers], value_input_option='RAW')

# -------------------- UI --------------------
st.title('–ê–Ω–∫–µ—Ç–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è')
st.markdown(
    '–ü—Ä–æ–µ–∫—Ç–Ω–æ-—É—á–µ–±–Ω–∞—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –®–∫–æ–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥—É—Å—Ç—Ä–∏–π '
    '–ù–ò–£ –í–®–≠ –ø—Ä–æ–≤–æ–¥–∏—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞ –∞–Ω–∞–ª–∏–∑ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∏ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–π '
    '–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏. –ú—ã –ø—Ä–æ—Å–∏–º –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –Ω–∞—à–µ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏, –æ—Ç–≤–µ—Ç–∏–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∞–Ω–∫–µ—Ç—ã (—ç—Ç–æ –∑–∞–π–º–µ—Ç 7‚Äì10 –º–∏–Ω—É—Ç), –∞ —Ç–∞–∫–∂–µ '
    '–µ—Å–ª–∏ –≤—ã –≥–æ—Ç–æ–≤—ã –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–µ —Ñ–æ–∫—É—Å-–≥—Ä—É–ø–ø –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏ –æ—Ç –®–∫–æ–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π, '
    '–æ—Å—Ç–∞–≤—å—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–≤–æ–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å.\n\n'
    '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –æ–±–æ–±—â–µ–Ω–Ω–æ–º –≤–∏–¥–µ, –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏–º–µ–Ω. '
    '–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±—ã—Ö –∑–Ω–∞–Ω–∏–π.\n\n'
    '–ó–∞—Ä–∞–Ω–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ —É—á–∞—Å—Ç–∏–µ!'
)

if 't_start' not in st.session_state:
    st.session_state['t_start'] = time.time()

email = st.text_input('–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å (–ø–æ –∂–µ–ª–∞–Ω–∏—é)')

st.markdown('---')
st.subheader('1. –í—ã–±–µ—Ä–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —á—Ç–æ –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –í—ã —Å—á–∏—Ç–∞–µ—Ç–µ –¥–ª—è —Å–µ–±—è –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–º')
st.caption('–£–∫–∞–∂–∏—Ç–µ –æ—Ç 3 –¥–æ 5 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤')
q1_vals = st.multiselect('–û—Ç–º–µ—Ç—å—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã', q1_options)

st.markdown('---')
st.subheader('2. –ü–µ—Ä–µ–¥ –í–∞–º–∏ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –≤—ã—è–≤–ª–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –æ–±—ã—á–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –∂–∏–∑–Ω–∏. –ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Ç–∏–ø–∏—á–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ –¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π ¬´–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π¬ª –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–¥–µ—Ç –≤–∞–º –≤ –≥–æ–ª–æ–≤—É')
st.caption('–ï—Å–ª–∏ –≤—ã —Å–æ–≥–ª–∞—Å–Ω—ã —Å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º, –æ—Ç–≤–µ—á–∞–π—Ç–µ ¬´–¥–∞¬ª, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî ¬´–Ω–µ—Ç¬ª.')
b2_answers = {}
for i in range(1, 23):
    b2_answers[f'b2_{i}'] = st.radio(f'{i}. {b2_text[i]}', ['–î–∞', '–ù–µ—Ç'], horizontal=True, key=f'b2_{i}')

st.markdown('---')
st.subheader('3. –í—ã–±–µ—Ä–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —á—Ç–æ –∏–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –í—ã —Å—á–∏—Ç–∞–µ—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ä–µ–∞–∫—Ü–∏–µ–π –¥–ª—è —Å–µ–±—è –≤ —Å–∏—Ç—É–∞—Ü–∏–∏ —Å—Ç—Ä–µ—Å—Å–∞ –∏–ª–∏ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏')
st.caption('–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –æ—Ç 4 –¥–æ 7 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤')
q3_vals = st.multiselect('–û—Ç–º–µ—Ç—å—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã', q3_options)

st.markdown('---')
st.subheader('4. ¬´–û–∫–∞–∑–∞–≤—à–∏—Å—å –≤ —Ç—Ä—É–¥–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, —è‚Ä¶¬ª (–¥–æ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)')
q4_vals = st.multiselect('–û—Ç–º–µ—Ç—å—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã', q4_options, max_selections=3)
q4_free = ''
if '–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç' in q4_vals:
    q4_free = st.text_area('–û–ø–∏—à–∏—Ç–µ ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª', '')

st.markdown('---')
st.subheader('5. –£—á–∞—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö?')
q5 = {}
for item in q5_items[:-1]:
    q5[item] = st.radio(item, FREQ3, horizontal=True, index=2, key=f'q5_{item}')
q5_own_enabled = st.checkbox('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç', key='q5_own')
q5['–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'] = '–í–∫–ª—é—á–µ–Ω–æ' if q5_own_enabled else '–ù–µ –≤—ã–±—Ä–∞–Ω–æ'
q5_free_text = ''
if q5_own_enabled:
    q5_free_text = st.text_input('–û–ø–∏—à–∏—Ç–µ ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª', '')

st.markdown('---')
st.subheader('6. –ö–∞–∫ —á–∞—Å—Ç–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥ –≤—ã –ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏, —á—Ç–æ–±—ã –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ-–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã?')
st.caption('–®–∫–∞–ª–∞: -1 ‚Äî –∏–∑–±–µ–≥–∞—é; 0 ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª(–∞); 5 ‚Äî –æ—á–µ–Ω—å —á–∞—Å—Ç–æ')
q6 = {}
for item in q6_items[:-1]:  # –≤—Å—ë –∫—Ä–æ–º–µ ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª
    q6[item] = st.slider(item, min_value=-1, max_value=5, value=0, step=1, key=f'q6_{item}')
q6_own_enabled = st.checkbox('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç', key='q6_own')
q6['–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'] = 1 if q6_own_enabled else 0
q6_free_text = ''
if q6_own_enabled:
    q6_free_text = st.text_input('–û–ø–∏—à–∏—Ç–µ ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª', '')

st.markdown('---')
st.subheader('7. –ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –º–µ—á—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –±—ã —Ö–æ—Ç–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å?')
q7 = st.radio('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç', ['–î–ê', '–ù–ï–¢'], horizontal=True)
q8 = q9 = q10 = ''
if q7 == '–î–ê':
    q8 = st.text_area('8. –ö–∞–∫—É—é –º–µ—á—Ç—É –í—ã –±—ã —Ö–æ—Ç–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ 2025 –≥–æ–¥–∞?', '')
    q9 = st.text_area('9. –ö–∞–∫–∏–µ –º–µ—á—Ç—ã –í—ã –±—ã —Ö–æ—Ç–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ –ø—è—Ç—å –ª–µ—Ç?', '')
    q10 = st.text_area('10. –ö–∞–∫–∏–µ –º–µ—á—Ç—ã –í—ã –±—ã —Ö–æ—Ç–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ –¥–µ—Å—è—Ç—å‚Äì–¥–≤–∞–¥—Ü–∞—Ç—å –ª–µ—Ç?', '')

st.markdown('---')
st.subheader('–ù–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ –≤–∞—Å')
sex = st.radio('–ü–æ–ª', ['–ú—É–∂', '–ñ–µ–Ω'], horizontal=True)
age = st.number_input('–í–æ–∑—Ä–∞—Å—Ç (–ø–æ–ª–Ω—ã—Ö –ª–µ—Ç)', min_value=14, max_value=120, step=1)
edu = st.selectbox('–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', [
    '–û—Å–Ω–æ–≤–Ω–æ–µ –æ–±—â–µ–µ (9 –∫–ª–∞—Å—Å–æ–≤)',
    '–°—Ä–µ–¥–Ω–µ–µ –æ–±—â–µ–µ (11 –∫–ª–∞—Å—Å–æ–≤)',
    '–°—Ä–µ–¥–Ω–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ (–∫–æ–ª–ª–µ–¥–∂/—Ç–µ—Ö–Ω–∏–∫—É–º)',
    '–í—ã—Å—à–µ–µ I —Å—Ç–µ–ø–µ–Ω–∏ (–±–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç)',
    '–í—ã—Å—à–µ–µ II —Å—Ç–µ–ø–µ–Ω–∏ (—Å–ø–µ—Ü–∏–∞–ª–∏—Ç–µ—Ç/–º–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞)',
    '–í—ã—Å—à–µ–µ —Å —É—á—ë–Ω–æ–π —Å—Ç–µ–ø–µ–Ω—å—é'
])
sector = st.selectbox('–°—Ñ–µ—Ä–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏', [
    '–†–∞–±–æ—á–∏–π',
    '–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏ –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏',
    '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –≤ –Ω–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ñ–µ—Ä–µ (—É—á–∏—Ç–µ–ª—å, –≤—Ä–∞—á, —Ä–∞–±–æ—Ç–Ω–∏–∫ –Ω–∞—É–∫–∏, –∫—É–ª—å—Ç—É—Ä—ã –∏ —Ç.–ø.)',
    '–†–∞–±–æ—Ç–Ω–∏–∫ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞',
    '–í–æ–µ–Ω–Ω–æ—Å–ª—É–∂–∞—â–∏–π',
    '–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ä–≥–∞–Ω–æ–≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ–ª',
    '–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å',
    '–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä',
    '–£—á–∞—â–∏–π—Å—è, —Å—Ç—É–¥–µ–Ω—Ç',
    '–î–æ–º–æ—Ö–æ–∑—è–π–∫–∞',
    '–ù–µ —Ä–∞–±–æ—Ç–∞—é',
    '–î—Ä—É–≥–æ–µ'
])
family = st.selectbox('–°–µ–º–µ–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ', [
    '–ñ–µ–Ω–∞—Ç/–∑–∞–º—É–∂–µ–º', '–†–∞–∑–≤–µ–¥–µ–Ω(–∞)', '–í–¥–æ–≤–µ—Ü(–∞)', '–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ—Å—Ç–æ—è–ª(–∞) –≤ –±—Ä–∞–∫–µ'
])
kids = st.selectbox('–ù–∞–ª–∏—á–∏–µ –¥–µ—Ç–µ–π', [
    '–û–¥–∏–Ω —Ä–µ–±–µ–Ω–æ–∫', '–î–≤–∞ —Ä–µ–±–µ–Ω–∫–∞', '–¢—Ä–æ–µ –∏ –±–æ–ª–µ–µ –¥–µ—Ç–µ–π',
    '–î–µ—Ç–µ–π –Ω–µ—Ç, –Ω–æ –ø–ª–∞–Ω–∏—Ä—É—é –≤ –±–ª–∏–∂–∞–π—à–∏–µ —Ç—Ä–∏ –≥–æ–¥–∞', '–î–µ—Ç–µ–π –Ω–µ—Ç, –ø–æ–∫–∞ –Ω–µ –∑–∞–¥—É–º—ã–≤–∞–ª—Å—è(–∞—Å—å)'
])
living = st.selectbox('–°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ', [
    '–ñ–∏–≤—É –≤ —Å–µ–º—å–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π –∏/–∏–ª–∏ —Å—Ç–∞—Ä—à–µ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è',
    '–ñ–∏–≤—É –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–µ–º—å–µ',
    '–ñ–∏–≤—É –æ—Ç–¥–µ–ª—å–Ω–æ'
])
locality = st.selectbox('–ú–µ—Å—Ç–æ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞', [
    '–°–≤–µ—Ä—Ö–∫—Ä—É–ø–Ω—ã–π –≥–æ—Ä–æ–¥ (>3 –º–ª–Ω)',
    '–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≥–æ—Ä–æ–¥ (1‚Äì3 –º–ª–Ω)',
    '–ö—Ä—É–ø–Ω—ã–π –≥–æ—Ä–æ–¥ (250‚Äì1000 —Ç—ã—Å.)',
    '–ë–æ–ª—å—à–æ–π –≥–æ—Ä–æ–¥ (100‚Äì250 —Ç—ã—Å.)',
    '–°—Ä–µ–¥–Ω–∏–π –≥–æ—Ä–æ–¥ (50‚Äì100 —Ç—ã—Å.)',
    '–ú–∞–ª—ã–π –≥–æ—Ä–æ–¥ –∏/–∏–ª–∏ –ø–æ—Å–µ–ª–æ–∫ (<50 —Ç—ã—Å.)'
])
consent = st.checkbox('–°–æ–≥–ª–∞—Å–µ–Ω(–Ω–∞) –Ω–∞ —É—á–∞—Å—Ç–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç–≤–µ—Ç–æ–≤ –≤ –æ–±–æ–±—â—ë–Ω–Ω–æ–º –≤–∏–¥–µ')

submitted = st.button('–û—Ç–ø—Ä–∞–≤–∏—Ç—å')

# -------------------- –°–∞–±–º–∏—Ç --------------------
def append_row():
    response_id = str(uuid.uuid4())
    duration_sec = int(time.time() - st.session_state['t_start'])

    extro_score, extro_class, otro_score, otro_class = score_block2(b2_answers)
    q1_adapt, q1_social, q1_indiv = orientations_counts_q1(q1_vals)
    q3_rel, q3_anx, q3_avo = stress_types_counts_q3(q3_vals)

    row = {
        'response_id': response_id,
        'ts': datetime.utcnow().isoformat(timespec='seconds'),
        'duration_sec': duration_sec,
        'email': email or '',
        'q1_values': '; '.join(q1_vals),
        'q1_adaptation_cnt': q1_adapt,
        'q1_socialization_cnt': q1_social,
        'q1_individualization_cnt': q1_indiv,
    }

    for i in range(1, 23):
        row[f'b2_{i}'] = b2_answers.get(f'b2_{i}', '')

    row.update({
        'b2_extro_score': extro_score,
        'b2_extro_class': extro_class,
        'b2_otro_score': otro_score,
        'b2_otro_class': otro_class,
    })

    row.update({
        'q3_values': '; '.join(q3_vals),
        'q3_reliable_cnt': q3_rel,
        'q3_anxious_cnt': q3_anx,
        'q3_avoidant_cnt': q3_avo,
    })

    row['q4_values'] = '; '.join(q4_vals)
    row['q4_free'] = q4_free

    for name in q5_items[:-1]:
        row[f'q5_{name}'] = q5.get(name, '')
    row['q5_–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'] = q5.get('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç', '–ù–µ –≤—ã–±—Ä–∞–Ω–æ')
    row['q5_free_text'] = q5_free_text
    for name in q5_items[:-1]:
        row[f'q5_{name}_code'] = MAP_Q5.get(q5.get(name, ''), '')
    row['q5_–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç_code'] = ''

    for name in q6_items[:-1]:
        v = q6.get(name, 0)
        row[f'q6_{name}'] = v
        row[f'q6_{name}_any'] = 1 if v > 0 else 0
    row['q6_–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç'] = q6.get('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç', 0)
    row['q6_–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç_any'] = 1 if q6.get('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç', 0) == 1 else 0
    row['q6_free_text'] = q6_free_text

    row.update({
        'q7_any_dreams': q7,
        'q8_2025': q8,
        'q9_5y': q9,
        'q10_10_20y': q10,
        'sex': sex,
        'age': age,
        'edu': edu,
        'sector': sector,
        'family': family,
        'kids': kids,
        'living': living,
        'locality': locality,
        'consent': 'yes' if consent else 'no'
    })

    append_to_sheet(HEADERS, row)

if submitted:
    errors = []
    if email and not _valid_email(email):
        errors.append('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç e-mail.')
    ok1, msg1 = validate_multiselect(q1_vals, min_sel=3, max_sel=5)
    if not ok1:
        errors.append('–ë–ª–æ–∫ 1: ' + msg1)
    ok3, msg3 = validate_multiselect(q3_vals, min_sel=4, max_sel=7)
    if not ok3:
        errors.append('–ë–ª–æ–∫ 3: ' + msg3)
    missing_b2 = [i for i in range(1, 23) if b2_answers.get(f'b2_{i}') not in ('–î–∞', '–ù–µ—Ç')]
    if missing_b2:
        errors.append(f'–ë–ª–æ–∫ 2: –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã ({len(missing_b2)} –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ).')
    if '–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç' in q4_vals:
        if not q4_free or not _has_cyrillic(q4_free):
            errors.append('–ü.4: ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ.')
    if q5.get('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç') == '–í–∫–ª—é—á–µ–Ω–æ':
        if not q5_free_text or not _has_cyrillic(q5_free_text):
            errors.append('–ü.5: ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ.')
    if q6.get('–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç') == 1:
        if not q6_free_text or not _has_cyrillic(q6_free_text):
            errors.append('–ü.6: ¬´–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ.')
    if q7 == '–î–ê':
        if not q8 or not _has_cyrillic(q8):
            errors.append('–ü.8: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞).')
        if not q9 or not _has_cyrillic(q9):
            errors.append('–ü.9: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞).')
        if not q10 or not _has_cyrillic(q10):
            errors.append('–ü.10: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞).')
    if not consent:
        errors.append('–ù—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —É—á–∞—Å—Ç–∏–µ.')

    if errors:
        for e in errors:
            st.error(e)
    else:
        try:
            append_row()
            st.success('–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç. –°–ø–∞—Å–∏–±–æ!')
        except Exception as e:
            st.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ Google Sheets: ' + str(e))
